<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MeAI – おへやをおそうじ</title>
<link rel="icon" href="data:,">
<style>
  :root{ --fg:#fff; --glass:rgba(255,255,255,.07); --glass-border:rgba(255,255,255,.16); }
  body{margin:0;color:var(--fg);
    background:#000 url("public/space_background.png") center/cover fixed no-repeat;
    font-family:"Noto Sans JP",system-ui,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;}
  .wrap{max-width:720px;margin:0 auto;padding:24px}
  .glass{background:var(--glass);border:1px solid var(--glass-border);border-radius:16px;backdrop-filter:blur(8px)}
  .pad{padding:16px}
  .btn{border:none;border-radius:999px;padding:10px 16px;cursor:pointer;color:#fff;background:rgba(255,255,255,.18)}
  .btn:hover{background:rgba(255,255,255,.28)} .btn[disabled]{opacity:.55;cursor:not-allowed}
  #char{display:flex;flex-direction:column;align-items:center;gap:8px}
  #char img{width:240px;height:auto;animation:sway 5s ease-in-out infinite;transform-origin:50% 0%}
  @keyframes sway{0%{transform:rotate(0)}25%{transform:rotate(1.2deg)}50%{transform:rotate(0)}75%{transform:rotate(-1.2deg)}100%{transform:rotate(0)}}
</style>
</head>
<body>
<div class="wrap">
  <div class="pad" style="display:flex;justify-content:space-between;align-items:center">
    <h1 style="margin:0;font-size:22px">おへやをおそうじ</h1>
    <div style="display:flex;gap:8px">
      <a class="btn" href="Room.html">← お世話コーナー</a>
      <a class="btn" href="index.html">ホーム</a>
    </div>
  </div>

  <div class="glass pad" id="char">
    <img id="charImg" src="public/char/blue/calm.png" alt="char">
    <div id="line" style="opacity:.95"></div>
    <button id="cleanBtn" class="btn">🧹 きれいにした！</button>
    <div id="info" style="margin-top:8px;opacity:.9;font-size:13px">※1日1回だけ。成功で ❤️+1</div>
  </div>
</div>

<script>
const LS_STATE='MEAI_STATE_V3', LS_CARE='MEAI_CARE_PROGRESS_V1';
const COLORS=['blue','pink','green','purple'], EMOTIONS=['calm','joy','sad','sleep'];
const today=()=>new Date().toISOString().slice(0,10);
function loadState(){return JSON.parse(localStorage.getItem(LS_STATE)||'{"userName":"","charColor":"blue","hearts":0,"streakDays":0,"stamps":0,"lastActionDate":null,"stage":"S0","unlocked":{"skins":[],"bg":[],"lines":[]}}');}
function saveState(s){localStorage.setItem(LS_STATE,JSON.stringify(s));}
function loadCare(){return JSON.parse(localStorage.getItem(LS_CARE)||'{}');}
function saveCare(c){localStorage.setItem(LS_CARE,JSON.stringify(c));}
function setEmotion(st,emo='calm'){const c=COLORS.includes(st.charColor)?st.charColor:'blue';document.getElementById('charImg').src=`public/char/${c}/${EMOTIONS.includes(emo)?emo:'calm'}.png`;}

function init(){
  const st=loadState(); setEmotion(st,'calm');
  document.getElementById('line').textContent=`${st.userName||'あなた'}さん、サッとおそうじしてみよう。`;
  const care=loadCare(); const key=today();
  const already = care[key]?.cleanDone;
  const btn=document.getElementById('cleanBtn');
  if(already){ btn.textContent='今日は済み'; btn.disabled=true; }

  btn.addEventListener('click', ()=>{
    const care2=loadCare(); const k=today();
    if(care2[k]?.cleanDone){ btn.disabled=true; return; }
    care2[k]=Object.assign({feedDone:false, cleanDone:false}, care2[k]);
    care2[k].cleanDone=true; saveCare(care2);

    const s=loadState(); s.hearts+=1; s.lastActionDate=today(); saveState(s);
    setEmotion(s,'joy'); setTimeout(()=>setEmotion(s,'calm'),1200);

    btn.textContent='今日は済み'; btn.disabled=true;
  });
}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
