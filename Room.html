<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MeAI | room</title>
<link rel="icon" href="data:,">
<style>
  :root{ --glass: rgba(255,255,255,.05); --glass-b: rgba(255,255,255,.12); --blue:#60a5fa; --ok:#5be37e; }
  html,body{height:100%}
  body{ margin:0; font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif; color:#fff; background:#0a0f1a; overflow:hidden; }
  .wrap{ position:relative; z-index:2; max-width:980px; margin:0 auto; padding:14px }
  .top{ display:flex; align-items:center; justify-content:space-between; gap:10px }
  .btn{ display:inline-flex; align-items:center; gap:.5em; border:none; border-radius:999px; padding:10px 14px; cursor:pointer; color:#fff; background:var(--blue); font-weight:700 }
  .btn-ghost{ background:transparent; border:1px solid var(--glass-b) }
  .pill{ display:inline-flex; align-items:center; gap:.5em; padding:6px 10px; border-radius:999px; background:var(--glass); border:1px solid var(--glass-b) }
  .card{ background:var(--glass); border:1px solid var(--glass-b); border-radius:18px; padding:12px 14px; backdrop-filter: blur(6px) saturate(120%); }
  .room{ position:fixed; inset:0; overflow:hidden; }
  .bg{ position:absolute; inset:0; z-index:0; background: radial-gradient(60% 80% at 70% 30%, #1d2b53, transparent 60%), radial-gradient(70% 90% at 20% 70%, #0b5b5b55, transparent 60%), url('public/space_background.png') center/cover fixed no-repeat; filter:brightness(.9); }
  .floor{ position:absolute; left:50%; bottom:-40px; transform:translateX(-50%); width:80vw; height:22vh; background: radial-gradient(ellipse at center, rgba(0,0,0,.5), rgba(0,0,0,0) 70%); z-index:1 }

  /* pet */
  #pet{ position:absolute; z-index:25; width:160px; height:160px; transform-origin:50% 60%; filter:drop-shadow(0 10px 24px rgba(0,0,0,.5)); animation:yura 3.4s ease-in-out infinite; left:50%; top:55%; transform:translate(-50%,-50%); pointer-events:none }
  #pet img{ width:100%; height:100%; object-fit:contain }
  @keyframes yura{ 0%,100%{ transform:translate(-50%,-50%) rotate(-3deg);} 50%{ transform:translate(-50%,-52%) rotate(3deg);} }

  .hud{ position:fixed; left:50%; bottom:16px; transform:translateX(-50%); display:flex; gap:8px; z-index:30 }

  /* props */
  .prop{ position:absolute; z-index:28; filter:drop-shadow(0 8px 16px rgba(0,0,0,.5)); }
  .food{ width:120px; height:120px; left:55%; top:62%; background:url('public/props/rice_bowl.png') center/contain no-repeat }
  .water{ width:120px; height:120px; left:45%; top:62%; background:url('public/props/water_drop.png') center/contain no-repeat }
  .broom{ width:140px; height:140px; left:52%; top:58%; background:url('public/props/broom.png') center/contain no-repeat }
  .hand{ width:140px; height:140px; left:48%; top:50%; background:url('public/props/hand.png') center/contain no-repeat; animation:petHand 2.4s ease-in-out infinite }
  @keyframes petHand{ 0%,100%{ transform:translateY(0)} 50%{ transform:translateY(-6px)} }

  .noteBurst{ position:absolute; z-index:40; font-size:22px; pointer-events:none; animation: rise 900ms ease-out forwards }
  @keyframes rise{ to{ transform: translateY(-60px); opacity:0 } }

  .poop{ position:absolute; z-index:35; font-size:40px; cursor:pointer; user-select:none; animation: floaty 2.2s ease-in-out infinite; filter: drop-shadow(0 0 8px rgba(0,0,0,.6)) }
  @keyframes floaty{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
</style>
</head>
<body>
<div class="room">
  <div class="bg" id="bg"></div>
  <div class="floor"></div>
  <div id="pet"><img id="petImg" src="public/char/blue/calm.png" alt="pet"></div>
  <div id="prop" class="prop"></div>
</div>

<div class="wrap">
  <div class="top">
    <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
      <button class="btn-ghost btn" id="backBtn">‚Üê Êàª„Çã</button>
      <div class="pill" id="modeLabel">room</div>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <div class="pill">‚ù§Ô∏è <span id="hearts">0</span></div>
      <div class="pill">‚ô™ <span id="notes">0</span></div>
    </div>
  </div>

  <div class="card" style="margin-top:10px">
    <div id="roomDesc" class="muted">„Åä‰∏ñË©±ÈÉ®Â±ã„Å∏„Çà„ÅÜ„Åì„Åù„ÄÇ</div>
  </div>
</div>

<div class="hud">
  <button class="btn" id="actionBtn">ÂÆüË°å</button>
</div>

<script>
// ===== helpers & LS keys =====
const LS={ YOU:'meai_you', HEARTS:'meai_hearts', NOTES:'meai_notes', CHAR_COLOR:'meai_char_color', CHAR_ID:'meai_char_id', CHAR_LABEL:'meai_char_label', CHAR_NAME:'meai_char_name', SATIETY:'meai_satiety', CLEAN:'meai_clean', MOOD:'meai_mood', LANG:'meai_lang' };
const get=(k,d)=>{const v=localStorage.getItem(k);return v===null?d:isNaN(v)?v:Number(v)};
const set=(k,v)=>localStorage.setItem(k,String(v));
const inc=(k,by=1)=>{const v=get(k,0)+by; set(k,v); return v};

const params=new URLSearchParams(location.search); const MODE=params.get('mode')||'feed';
const heartsEl=document.getElementById('hearts'); const notesEl=document.getElementById('notes');
const petImg=document.getElementById('petImg'); const prop=document.getElementById('prop');
const modeLabel=document.getElementById('modeLabel'); const roomDesc=document.getElementById('roomDesc');
const actionBtn=document.getElementById('actionBtn'); const bg=document.getElementById('bg');

function setPetImage(){ const map=[
  {color:'pink',id:'joy',path:'public/char/pink/joy.png'},
  {color:'pink',id:'calm',path:'public/char/pink/calm.png'},
  {color:'purple',id:'calm',path:'public/char/purple/calm.png'},
  {color:'purple',id:'joy',path:'public/char/purple/joy.png'},
  {color:'blue',id:'calm',path:'public/char/blue/calm.png'},
  {color:'blue',id:'joy',path:'public/char/blue/joy.png'},
  {color:'green',id:'calm',path:'public/char/green/calm.png'},
  {color:'green',id:'joy',path:'public/char/green/joy.png'}];
  const color=get(LS.CHAR_COLOR,'blue'), id=get(LS.CHAR_ID,'calm');
  const item=map.find(m=>m.color===color&&m.id===id);
  petImg.src=item?item.path:'public/char/blue/calm.png';
}

function i18n(){ const l=localStorage.getItem(LS.LANG)||'ja'; const pack={
  ja:{back:'‚Üê Êàª„Çã', feed:['„ÅîÈ£Ø„ÅÆÈÉ®Â±ã','„ÅîÈ£Ø„Çí„ÅÇ„Åí„Çà„ÅÜ','üçô „ÇÇ„Åê„ÇÇ„ÅêÔºÅ +Ê∫ÄËÖπ +„Åî„Åç„Åí„Çì'], water:['„ÅäÊ∞¥„ÅÆÈÉ®Â±ã','„ÅäÊ∞¥„Çí„ÅÇ„Åí„Çà„ÅÜ','üíß „Åî„Åè„Åî„ÅèÔºÅ +Ê∫ÄËÖπ +„Åî„Åç„Åí„Çì'], pet:['„Å™„Åß„Å™„Åß„ÅÆÈÉ®Â±ã','„Å™„Åß„Å¶„ÅÇ„Åí„Çà„ÅÜ','ü§≤ „Çà„Åó„Çà„ÅóÔºÅ +„Åî„Åç„Åí„Çì'], clean:['„ÅäÊéÉÈô§„ÅÆÈÉ®Â±ã','„ÅäÁâá„Å•„Åë„Åó„Çà„ÅÜ','üßπ „Å¥„Åã„Å¥„ÅãÔºÅ +Ê∏ÖÊΩî'], exec:'ÂÆüË°å'},
  en:{back:'‚Üê Back', feed:['Feeding Room','Give some food','üçô Yum! +Satiety +Mood'], water:['Water Room','Give water','üíß Slurp! +Satiety +Mood'], pet:['Petting Room','Pet gently','ü§≤ Pat pat! +Mood'], clean:['Cleaning Room','Tidy up','üßπ Sparkly! +Clean'], exec:'Do'},
  ko:{back:'‚Üê ÎèåÏïÑÍ∞ÄÍ∏∞', feed:['Î∞• Î∞©','Î∞•ÏùÑ Ï£ºÏûê','üçô ÎÉ†! +Ìè¨Îßå +Í∏∞Î∂Ñ'], water:['Î¨º Î∞©','Î¨ºÏùÑ Ï£ºÏûê','üíß ÍøÄÍ∫Ω! +Ìè¨Îßå +Í∏∞Î∂Ñ'], pet:['Ïì∞Îã¥ Î∞©','Ïì∞Îã§Îì¨Í∏∞','ü§≤ Ïì∞Îã¥! +Í∏∞Î∂Ñ'], clean:['Ï≤≠ÏÜå Î∞©','Ï†ïÎ¶¨ÌïòÏûê','üßπ Î∞òÏßù! +Ï≤≠Í≤∞'], exec:'Ïã§Ìñâ'},
  zh:{back:'‚Üê ËøîÂõû', feed:['ÂñÇÈ£üÊàø','ÂñÇÁÇπÈ•≠','üçô Â•ΩÂêÉÔºÅ+È•±ËÖπ +ÂøÉÊÉÖ'], water:['ÂñùÊ∞¥Êàø','ÁªôÊ∞¥','üíß ÂíïÂôúÔºÅ+È•±ËÖπ +ÂøÉÊÉÖ'], pet:['ÊäöÊë∏Êàø','Êë∏Êë∏','ü§≤ Â•Ω‰πñÔºÅ+ÂøÉÊÉÖ'], clean:['Ê∏ÖÁêÜÊàø','ÊâìÊâ´','üßπ Âπ≤ÂáÄÔºÅ+Ê∏ÖÊ¥Å'], exec:'ÊâßË°å'} }[l]; return pack; }

function setRoom(){ const t=i18n(); document.getElementById('backBtn').textContent=t.back; actionBtn.textContent=t.exec; let title,sub; prop.className='prop'; switch(MODE){
  case 'feed': title=t.feed[0]; sub=t.feed[1]; prop.classList.add('food'); bg.style.filter='hue-rotate(-10deg) brightness(.9)'; break;
  case 'water': title=t.water[0]; sub=t.water[1]; prop.classList.add('water'); bg.style.filter='hue-rotate(-60deg) brightness(.95)'; break;
  case 'pet': title=t.pet[0]; sub=t.pet[1]; prop.classList.add('hand'); bg.style.filter='hue-rotate(40deg) brightness(.95)'; break;
  case 'clean': title=t.clean[0]; sub=t.clean[1]; prop.classList.add('broom'); bg.style.filter='hue-rotate(180deg) brightness(.9)'; spawnPoops(3); break;
  default: title='room'; sub='';
 }
 modeLabel.textContent=title; roomDesc.textContent=sub;
}

function spawnPoop(){ const el=document.createElement('div'); el.className='poop'; el.textContent='üí©'; const x=Math.random()*(innerWidth-60)+30, y=Math.random()*(innerHeight-260)+140; el.style.left=x+'px'; el.style.top=y+'px'; document.body.appendChild(el); el.onclick=()=>{ el.remove(); addClean(8); burstNote(x,y); } }
function spawnPoops(n){ for(let i=0;i<n;i++){ setTimeout(spawnPoop, 500+i*600); } }
function burstNote(x,y){ const b=document.createElement('div'); b.className='noteBurst'; b.textContent='‚ô™'; b.style.left=x+'px'; b.style.top=y+'px'; document.body.appendChild(b); setTimeout(()=>b.remove(),900); }

// stats helpers
function setBar(k,delta,min=0,max=100){ const nv=Math.max(min,Math.min(max,get(k,50)+delta)); set(k,nv); }
function addSatiety(v){ setBar(LS.SATIETY,v); }
function addClean(v){ setBar(LS.CLEAN,v,0,100); }
function addMood(v){ setBar(LS.MOOD,v); }

function act(){ const t=i18n(); switch(MODE){
  case 'feed': addSatiety(15); addMood(6); toast(t.feed[2]); break;
  case 'water': addSatiety(8); addMood(4); toast(t.water[2]); break;
  case 'pet': addMood(12); hearts(5); toast(t.pet[2]); break;
  case 'clean': addClean(20); document.querySelectorAll('.poop').forEach(p=>p.remove()); toast(t.clean[2]); break;
 }
}

function hearts(n){ for(let i=0;i<n;i++){ setTimeout(()=>burstNote(innerWidth*0.52, innerHeight*0.5), i*120); } }

function toast(m){ const t=document.createElement('div'); t.textContent=m; t.style.position='fixed'; t.style.left='50%'; t.style.top='14px'; t.style.transform='translateX(-50%)'; t.style.background='#171717'; t.style.border='1px solid var(--glass-b)'; t.style.padding='8px 12px'; t.style.borderRadius='999px'; t.style.zIndex='50'; document.body.appendChild(t); setTimeout(()=>t.remove(),1400); }

// events
 document.getElementById('backBtn').onclick=()=>history.back();
 actionBtn.onclick=act;

// init
function init(){ heartsEl.textContent=get(LS.HEARTS,0); notesEl.textContent=get(LS.NOTES,0); setPetImage(); setRoom(); }

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
