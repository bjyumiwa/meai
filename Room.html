<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MeAI | Room</title>
<link rel="icon" href="data:,">
<style>
  :root{ --glass: rgba(255,255,255,.04); --glass-b: rgba(255,255,255,.12); --blue:#60a5fa; }
  html,body{height:100%}
  body{ margin:0; font-family:"Noto Sans JP",system-ui,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif; color:#fff; background:#0a0f1a; overflow:hidden; }
  .room{position:fixed;inset:0;overflow:hidden}
  .bg{position:absolute;inset:0;background: radial-gradient(60% 80% at 70% 30%, #1d2b53, transparent 60%), radial-gradient(70% 90% at 20% 70%, #0b5b5b55, transparent 60%), url('public/space_background.png') center/cover fixed no-repeat; filter:brightness(.9)}
  .floor{position:absolute;left:50%;bottom:-40px;transform:translateX(-50%);width:80vw;height:22vh;background: radial-gradient(ellipse at center, rgba(0,0,0,.5), rgba(0,0,0,0) 70%)}
  #pet{position:absolute;z-index:25;width:160px;height:160px;left:50%;top:55%;transform:translate(-50%,-50%);filter:drop-shadow(0 10px 24px rgba(0,0,0,.5));animation:yura 3.4s ease-in-out infinite;pointer-events:none}
  #pet img{width:100%;height:100%;object-fit:contain}
  @keyframes yura{0%,100%{transform:translate(-50%,-50%) rotate(-3deg)}50%{transform:translate(-50%,-52%) rotate(3deg)}}
  .wrap{position:relative;z-index:2;max-width:920px;margin:0 auto;padding:14px}
  .btn{display:inline-flex;align-items:center;gap:.5em;border:none;border-radius:999px;padding:10px 14px;cursor:pointer;color:#fff;background:var(--blue);font-weight:700}
  .btn-ghost{background:transparent;border:1px solid var(--glass-b)}
  .pill{background:rgba(255,255,255,.10);border-radius:999px;padding:6px 10px}
  .card{background:var(--glass);border:1px solid var(--glass-b);border-radius:18px;padding:12px 14px;backdrop-filter:blur(6px) saturate(120%)}
  .prop{position:absolute;z-index:28;filter:drop-shadow(0 8px 16px rgba(0,0,0,.5))}
  .food{width:120px;height:120px;left:55%;top:62%;background:url('public/props/rice_bowl.png') center/contain no-repeat}
  .water{width:120px;height:120px;left:45%;top:62%;background:url('public/props/water_drop.png') center/contain no-repeat}
  .broom{width:140px;height:140px;left:52%;top:58%;background:url('public/props/broom.png') center/contain no-repeat}
  .hand{width:140px;height:140px;left:48%;top:50%;background:url('public/props/hand.png') center/contain no-repeat;animation:petHand 2.4s ease-in-out infinite}
  @keyframes petHand{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
  .poop{position:absolute;z-index:35;font-size:40px;cursor:pointer;user-select:none;animation:float 2.2s ease-in-out infinite;filter:drop-shadow(0 0 8px rgba(0,0,0,.6))}
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
  .toast{position:fixed;left:50%;top:14px;transform:translateX(-50%);background:#171717;border:1px solid rgba(255,255,255,.2);padding:8px 12px;border-radius:999px;z-index:999}
</style>
</head>
<body>
<div class="room">
  <div class="bg" id="bg"></div>
  <div class="floor"></div>
  <div id="pet"><img id="petImg" src="public/char/blue/calm.png" alt=""></div>
  <div id="prop" class="prop"></div>
</div>

<div class="wrap">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
    <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
      <button class="btn-ghost btn" id="backBtn">‚Üê Êàª„Çã</button>
      <span class="pill" id="modeLabel">room</span>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <span class="pill">‚ù§Ô∏è <span id="hearts">0</span></span>
      <span class="pill">‚ô™ <span id="notes">0</span></span>
    </div>
  </div>

  <div class="card" style="margin-top:10px">
    <div id="desc" class="muted">„Åä‰∏ñË©±ÈÉ®Â±ã„Å∏„Çà„ÅÜ„Åì„Åù„ÄÇ</div>
  </div>
</div>

<div style="position:fixed;left:50%;bottom:16px;transform:translateX(-50%);z-index:30">
  <button class="btn" id="actionBtn">ÂÆüË°å</button>
</div>

<div class="toast hidden" id="toast"></div>

<script>
const LS={HEARTS:'meai_hearts',NOTES:'meai_notes',CHAR_COLOR:'meai_char_color',CHAR_ID:'meai_char_id'};
const $=q=>document.querySelector(q);
const set=(k,v)=>localStorage.setItem(k,String(v));
const get=(k,d)=>{const v=localStorage.getItem(k);return v===null?d:isNaN(v)?v:Number(v)};
const inc=(k,by=1)=>{const v=get(k,0)+by; set(k,v); return v};
function toast(m){ const t=$('#toast'); t.textContent=m; t.classList.remove('hidden'); clearTimeout(toast._t); toast._t=setTimeout(()=>t.classList.add('hidden'),1200); }

const MODE=new URLSearchParams(location.search).get('mode')||'feed';
function setPet(){ const color=get(LS.CHAR_COLOR,'blue'), id=get(LS.CHAR_ID,'calm'); $('#petImg').src=`public/char/${color}/${id}.png`; }
function setRoom(){
  const p=$('#prop'); p.className='prop';
  if(MODE==='feed'){ $('#desc').textContent='üçô „ÅîÈ£Ø„Çí„ÅÇ„Åí„Çà„ÅÜ'; $('#modeLabel').textContent='„ÅîÈ£Ø„ÅÆÈÉ®Â±ã'; p.classList.add('food'); }
  if(MODE==='water'){ $('#desc').textContent='üíß „ÅäÊ∞¥„Çí„ÅÇ„Åí„Çà„ÅÜ'; $('#modeLabel').textContent='„ÅäÊ∞¥„ÅÆÈÉ®Â±ã'; p.classList.add('water'); }
  if(MODE==='pet'){ $('#desc').textContent='ü§≤ „Å™„Åß„Å¶„ÅÇ„Åí„Çà„ÅÜ'; $('#modeLabel').textContent='„Å™„Åß„Å™„Åß„ÅÆÈÉ®Â±ã'; p.classList.add('hand'); }
  if(MODE==='clean'){ $('#desc').textContent='üßπ „ÅäÁâá„Å•„Åë„Åó„Çà„ÅÜ'; $('#modeLabel').textContent='„ÅäÊéÉÈô§„ÅÆÈÉ®Â±ã'; p.classList.add('broom'); poopMany(3); }
}
function poop(){ const d=document.createElement('div'); d.className='poop'; d.textContent='üí©'; d.style.left=(Math.random()*(innerWidth-60)+30)+'px'; d.style.top=(Math.random()*(innerHeight-260)+140)+'px'; document.body.appendChild(d); d.onclick=()=>{ d.remove(); toast('üßπ Clean!'); }; }
function poopMany(n){ for(let i=0;i<n;i++) setTimeout(poop,i*500); }

$('#actionBtn').onclick=()=>{ if(MODE==='feed'){ $('#hearts').textContent=inc(LS.HEARTS,1); toast('üçô „ÇÇ„Åê„ÇÇ„ÅêÔºÅ'); }
  if(MODE==='water'){ $('#notes').textContent=inc(LS.NOTES,1); toast('üíß „Åî„Åè„Åî„ÅèÔºÅ'); }
  if(MODE==='pet'){ $('#hearts').textContent=inc(LS.HEARTS,2); toast('ü§≤ „Çà„Åó„Çà„ÅóÔºÅ'); }
  if(MODE==='clean'){ document.querySelectorAll('.poop').forEach(p=>p.remove()); toast('‚ú® „Å¥„Åã„Å¥„ÅãÔºÅ'); } };

$('#backBtn').onclick=()=>history.back();

document.addEventListener('DOMContentLoaded', ()=>{ $('#hearts').textContent=get(LS.HEARTS,0); $('#notes').textContent=get(LS.NOTES,0); setPet(); setRoom(); });
</script>
</body>
</html>
