<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>MeAI</title>
<link rel="icon" href="data:,">
<style>
  :root{
    --fg:#fff; --dim:#cfd8dc; --accent:#8e7cff; --accent2:#4db6ff;
    --glass:rgba(255,255,255,.08); --bd:rgba(255,255,255,.18);
    --pad: clamp(12px, 4vw, 24px);
  }
  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0; color:var(--fg);
    font-family:"Noto Sans JP",system-ui,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
    background:#000 url("public/space_background.png") center/cover fixed no-repeat;
  }

  /* å…±é€š */
  .page{
    min-height:100dvh; display:flex; align-items:center; justify-content:center;
    padding: var(--pad); /* â† å·¦å³ã«å¸¸ã«ä½™ç™½ã‚’ç¢ºä¿ï¼ˆç«¯åˆ‡ã‚Œé˜²æ­¢ï¼‰ */
  }
  .hidden{display:none!important;}
  .container{
    width: min(100%, 1080px);
  }
  .panel{
    background:var(--glass); border:1px solid var(--bd); border-radius:18px;
    padding:var(--pad);
  }
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center;}
  .btn{ display:inline-flex; align-items:center; justify-content:center; gap:.5em; border:none; border-radius:999px; padding:12px 20px; cursor:pointer; color:#fff; font-weight:700; background:linear-gradient(135deg,var(--accent2),var(--accent)); }
  .btn.secondary{ background:linear-gradient(135deg,#607d8b,#90a4ae);}
  .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,.4); color:#fff; }
  .btn:disabled{ opacity:.55; cursor:not-allowed; }
  .title{font-weight:800; font-size:20px; margin:0 0 8px;}
  .spacer{height:10px;}
  img.char{ width:min(38vw,240px); height:auto; border-radius:18px; box-shadow:0 8px 24px rgba(0,0,0,.35); background:rgba(255,255,255,.06); }

  /* ===== Cover ===== */
  #cover h1{ font-size: clamp(28px, 5vw, 44px); margin:.1em 0 .2em; text-align:center; }
  #cover p{ color:var(--dim); text-align:center; margin:0 0 var(--pad); }

  .inputRow{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; width:100%; }
  input[type="text"]{
    flex:1 1 320px; max-width:560px;
    padding:12px 14px; border-radius:12px;
    border:1px solid rgba(255,255,255,.35);
    background:rgba(255,255,255,.18);
    color:#122; outline:none;
    box-shadow:0 6px 16px rgba(0,0,0,.18) inset;
    backdrop-filter: blur(6px);
    transition:border-color .15s, box-shadow .15s, background .15s;
  }
  input[type="text"]::placeholder{ color:rgba(17,34,34,.6); }
  input[type="text"]:focus{ background:rgba(255,255,255,.26); border-color:#9fbfff; box-shadow:0 0 0 3px rgba(79,166,255,.25); }
  #saveNameBtn{ height:44px; padding:0 18px; }

  /* ===== Game ===== */
  #greet{ font-size: clamp(16px, 2.6vw, 20px); }
  #layout{
    display:grid; gap:16px; align-items:start;
    grid-template-columns: 300px 1fr;  /* PC: 2ã‚«ãƒ©ãƒ  */
  }
  #charBox{ display:flex; flex-direction:column; align-items:center; gap:10px; }
  #stats{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
  .chip{ font-weight:700; padding:.35em .8em; border-radius:999px; background:rgba(255,255,255,.12); border:1px solid var(--bd); }
  #suggest{ font-size:18px; line-height:1.6; min-height:3em; }
  #log{ max-height:240px; overflow:auto; font-size:13px; opacity:.95; padding-left:18px; }
  #log li{ margin:.2em 0; }

  /* ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
  .modalWrap{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:var(--pad); background:rgba(0,0,0,.5); }
  .modal{ background:rgba(22,22,33,.94); border:1px solid var(--bd); border-radius:14px; padding:var(--pad); width:min(680px, 100%); }
  .gridChars{ display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:12px; }
  .gridChars .btn{ flex-direction:column; padding:10px; }

  /* ===== ã‚¹ãƒãƒ›æœ€é©åŒ– ===== */
  @media (max-width: 720px){
    #layout{ grid-template-columns: 1fr; } /* ã‚¹ãƒãƒ›: 1ã‚«ãƒ©ãƒ  */
    img.char{ width:min(60vw, 260px); }
    #log{ max-height:200px; }
  }
</style>
</head>
<body>

<!-- ================= Cover ================= -->
<section id="cover" class="page">
  <div class="container">
    <div class="panel">
      <h1>MeAI</h1>
      <p>å°ã•ãªâ€œã‚„ã£ã¦ã¿ã‚‹â€ã‚’ã‚„ã•ã—ãææ¡ˆã—ã¦ãã‚Œã‚‹ç›¸æ£’ã€‚</p>

      <div class="panel" style="background:rgba(255,255,255,.05);">
        <div class="inputRow">
          <input id="userNameInput" type="text" placeholder="ã‚ãªãŸã®åå‰" aria-label="ã‚ãªãŸã®åå‰">
          <button class="btn" id="saveNameBtn" type="button">åå‰ã‚’ä¿å­˜</button>
        </div>
        <div class="spacer"></div>
        <small>â€»ã‚ã¨ã§å¤‰æ›´ã§ãã¾ã™</small>
      </div>

      <div class="spacer"></div>

      <div class="row">
        <img id="coverChar" class="char" src="public/char/ako2.png" alt="ã‚­ãƒ£ãƒ©">
      </div>

      <div class="spacer"></div>
      <div class="row">
        <button class="btn" id="startBtn" type="button">ã¯ã˜ã‚ã‚‹</button>
      </div>
    </div>
  </div>
</section>

<!-- ================= Game ================= -->
<section id="game" class="page hidden">
  <div class="container">
    <div class="panel">
      <div id="greet">ã“ã‚“ã«ã¡ã¯ï¼</div>
      <div class="spacer"></div>

      <div id="layout">
        <!-- Left -->
        <div id="charBox">
          <img id="gameChar" class="char" src="public/char/ako2.png" alt="ã‚­ãƒ£ãƒ©">
          <div class="chip">ã‚­ãƒ£ãƒ©åï¼š<span id="charNick">ï¼ˆæœªè¨­å®šï¼‰</span></div>
          <div id="stats">
            <div class="chip">â™¡ <span id="heartNum">0</span></div>
            <div class="chip">ğŸ¯ ä»Šæ—¥ <span id="todayCount">0</span>/3</div>
            <div class="chip">ğŸ… <span id="stampNum">0</span></div>
          </div>
          <div class="row">
            <button class="btn" id="doneBtn">ã‚„ã£ãŸã‚ˆâ™¡</button>
            <button class="btn ghost" id="backBtn">ã‚«ãƒãƒ¼ã¸</button>
          </div>

          <div class="spacer"></div>
          <div class="panel" style="background:rgba(255,255,255,.05);">
            <p class="title">ãŠä¸–è©±ï¼ˆã„ã¤ã§ã‚‚OKï¼‰</p>
            <div class="row">
              <button class="btn secondary" id="careMeal">ã”ã¯ã‚“</button>
              <button class="btn secondary" id="careToilet">ãƒˆã‚¤ãƒ¬</button>
              <button class="btn secondary" id="carePet">ãªã§ã‚‹</button>
            </div>
          </div>
        </div>

        <!-- Right -->
        <div id="rightCol">
          <div class="panel" style="background:rgba(255,255,255,.05);">
            <p class="title">ä»Šæ—¥ã®ææ¡ˆ</p>
            <div id="suggest">æº–å‚™ä¸­â€¦</div>
            <div class="spacer"></div>
            <div class="row">
              <!-- è‡ªå‹•ææ¡ˆã«ã—ãŸã®ã§ã€Œå‡ºã™ã€ãƒœã‚¿ãƒ³ã¯ç„¡ã—ã€‚ã‚¹ã‚­ãƒƒãƒ—ã ã‘ç½®ã -->
              <button class="btn secondary" id="skipBtn">åˆ¥ã®æ¡ˆï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰</button>
              <button class="btn" id="clearBtn" disabled>ã‚¯ãƒªã‚¢ï¼</button>
            </div>
            <small>â€»ææ¡ˆã¯1æ—¥ã«æœ€å¤§3å›ã¾ã§è‡ªå‹•ã§å‡ºã¾ã™</small>
          </div>

          <div class="spacer"></div>
          <div class="panel" style="background:rgba(255,255,255,.05);">
            <p class="title">ãã‚ã</p>
            <ul id="log"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼šã‚­ãƒ£ãƒ©é¸æŠ ===== -->
<div id="modalSelect" class="modalWrap" role="dialog" aria-modal="true">
  <div class="modal">
    <h3 style="margin:0 0 8px">ã‚­ãƒ£ãƒ©ã‚’ãˆã‚‰ã¼ã†ï¼ï¼ˆ3å›ã‚¯ãƒªã‚¢ã§è§£æ”¾ï¼‰</h3>
    <div class="spacer"></div>
    <div id="charOptions" class="gridChars"></div>
    <div class="spacer"></div>
    <div class="row"><button class="btn ghost" id="closeSelect">ã¨ã˜ã‚‹</button></div>
  </div>
</div>

<!-- ===== ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼šã‚­ãƒ£ãƒ©å‘½å ===== -->
<div id="modalName" class="modalWrap" role="dialog" aria-modal="true">
  <div class="modal">
    <h3 style="margin:0 0 8px">ã‚­ãƒ£ãƒ©ã«åå‰ã‚’ã¤ã‘ã‚ˆã†ï¼ï¼ˆ5å›ã‚¯ãƒªã‚¢ã§è§£æ”¾ï¼‰</h3>
    <div class="spacer"></div>
    <input id="charNameInput" type="text" placeholder="ã‚­ãƒ£ãƒ©ã®åå‰">
    <div class="spacer"></div>
    <div class="row">
      <button class="btn" id="saveCharName">ä¿å­˜</button>
      <button class="btn ghost" id="closeName">ã¨ã˜ã‚‹</button>
    </div>
  </div>
</div>

<script>
/* ========= ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ & ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼ ========= */
const LS = {
  NAME:'MEAI_USER_NAME', HEART:'MEAI_HEART', STAMP:'MEAI_STAMP',
  CLEAR_TOTAL:'MEAI_CLEAR_TOTAL', TODAY_DATE:'MEAI_TODAY_DATE', TODAY_COUNT:'MEAI_TODAY_COUNT',
  CHAR_SRC:'MEAI_CHAR_SRC', CHAR_NAME:'MEAI_CHAR_NAME'
};
const $ = s => document.querySelector(s);
const on = (el,ev,fn)=>el&&el.addEventListener(ev,fn);
const todayStr = ()=> new Date().toISOString().slice(0,10);

/* ========= å¤‰æ•° ========= */
let hearts = Number(localStorage.getItem(LS.HEART)||0);
let stamps = Number(localStorage.getItem(LS.STAMP)||0);
let clearTotal = Number(localStorage.getItem(LS.CLEAR_TOTAL)||0);
let tDate = localStorage.getItem(LS.TODAY_DATE)||todayStr();
let tCount = Number(localStorage.getItem(LS.TODAY_COUNT)||0);
let currentSuggest = null;

/* æ—¥ä»˜åˆ‡ã‚Šæ›¿ãˆã§æ—¥æ¬¡å›æ•°ãƒªã‚»ãƒƒãƒˆ */
if (tDate !== todayStr()){ tDate=todayStr(); tCount=0; localStorage.setItem(LS.TODAY_DATE,tDate); localStorage.setItem(LS.TODAY_COUNT,tCount); }

/* ========= ãƒ‡ãƒ¼ã‚¿ ========= */
const CHAR_POOL = ["public/char/ako1.png","public/char/ako2.png","public/char/ako3.png"];
const SUGGESTS = [
  "æ°´ã‚’ä¸€æ¯é£²ã‚€","ç«‹ã¡ä¸ŠãŒã£ã¦30ç§’ã‚¹ãƒˆãƒ¬ãƒƒãƒ","5åˆ†ã ã‘æœºã‚’ç‰‡ã¥ã‘ã‚‹",
  "ä»Šæ—¥ã®è‰¯ã‹ã£ãŸã“ã¨ã‚’1ã¤æ›¸ã","10å›æ·±å‘¼å¸","æ­¯ç£¨ãã®ä»•ä¸Šã’30ç§’",
  "å¤–ã®ç©ºæ°—ã‚’å¸ã†","ã‚¿ã‚¤ãƒãƒ¼3åˆ†ã§é›†ä¸­","äººã«ä¸€è¨€ã‚ã‚ŠãŒã¨ã†ã‚’ä¼ãˆã‚‹",
  "ç›®ã‚’é–‰ã˜ã¦ä¼‘ã‚€30ç§’","ä½¿ã‚ãªã„ã‚¿ãƒ–ã‚’3ã¤é–‰ã˜ã‚‹","èƒŒã™ã˜ã‚’ä¼¸ã°ã™",
  "çŸ­ã„ãƒ¡ãƒ¢ã‚’1è¡Œã ã‘æ›¸ã","æ•£æ­©ã‚’1åˆ†","æ°´ã‚„ã‚Šã‚’ã™ã‚‹","ã‚´ãƒŸã‚’1ã¤æ¨ã¦ã‚‹"
];

/* ========= è¡¨ç¤ºæ›´æ–° ========= */
function pushLog(msg){
  const li=document.createElement('li'); li.textContent=`${new Date().toLocaleString()}ï½œ${msg}`;
  $('#log').prepend(li);
}
function renderHUD(){
  $('#heartNum').textContent = hearts;
  $('#stampNum').textContent = stamps;
  $('#todayCount').textContent = tCount;
  const name = localStorage.getItem(LS.NAME)||"";
  const call = name? `${name}ã•ã‚“ã€` : "";
  $('#greet').textContent = `${call}ã“ã‚“ã«ã¡ã¯ï¼ ä»Šæ—¥ã¯ã‚ã¨ ${Math.max(0, 3 - tCount)} å›ã‚¯ãƒªã‚¢ã§ãã¾ã™ã€‚`;
  $('#charNick').textContent = localStorage.getItem(LS.CHAR_NAME) || "ï¼ˆæœªè¨­å®šï¼‰";
}

/* ========= ã‚­ãƒ£ãƒ©é–¢é€£ ========= */
function imgExists(src){ return new Promise(res=>{ const i=new Image(); i.onload=()=>res(true); i.onerror=()=>res(false); i.src=src; }); }
async function buildCharOptions(){
  const wrap = $('#charOptions'); wrap.innerHTML="";
  const okList = await Promise.all(CHAR_POOL.map(imgExists));
  okList.forEach((ok,i)=>{
    if(!ok) return;
    const src=CHAR_POOL[i];
    const b=document.createElement('button');
    b.className='btn ghost'; b.style.flexDirection='column';
    b.innerHTML=`<img class="char" src="${src}" alt="char" style="width:140px"><div style="margin-top:6px">${src.split('/').pop()}</div>`;
    b.onclick=()=>{ localStorage.setItem(LS.CHAR_SRC, src); $('#coverChar').src=src; $('#gameChar').src=src; pushLog(`ã‚­ãƒ£ãƒ©å¤‰æ›´ï¼š${src}`); closeSelectModal(); };
    wrap.appendChild(b);
  });
}
function openSelectModal(){ $('#modalSelect').style.display='flex'; buildCharOptions(); }
function closeSelectModal(){ $('#modalSelect').style.display='none'; }
function openNameModal(){ $('#modalName').style.display='flex'; }
function closeNameModal(){ $('#modalName').style.display='none'; }

/* ========= ææ¡ˆï¼ˆè‡ªå‹•ï¼‰ ========= */
function pickSuggest(){
  if (tCount>=3){ $('#suggest').textContent="ä»Šæ—¥ã¯3å›ã¾ã§ã€‚æ˜æ—¥ã¾ãŸã‚„ã‚ã†ï¼"; $('#clearBtn').disabled=true; return; }
  const i=Math.floor(Math.random()*SUGGESTS.length);
  currentSuggest = SUGGESTS[i];
  $('#suggest').textContent = currentSuggest;
  $('#clearBtn').disabled=false;
  pushLog("ææ¡ˆã‚’è‡ªå‹•è¡¨ç¤º");
}
function autoNextSuggestAfterClear(){
  // ã‚¯ãƒªã‚¢å¾Œã€1.5ç§’å¾…ã£ã¦æ¬¡ã®ææ¡ˆã‚’è‡ªå‹•è¡¨ç¤ºï¼ˆæ®‹å›æ•°ãŒã‚ã‚Œã°ï¼‰
  if (tCount<3) setTimeout(pickSuggest, 1500);
}

/* ========= ã‚¤ãƒ™ãƒ³ãƒˆ ========= */
on($('#saveNameBtn'),'click',()=>{
  const v=($('#userNameInput').value||"").trim();
  localStorage.setItem(LS.NAME, v);
  pushLog(`åå‰ã‚’ä¿å­˜ï¼š${v||"(æœªè¨­å®š)"}`);
});

on($('#startBtn'),'click',()=>{
  const savedSrc = localStorage.getItem(LS.CHAR_SRC) || "public/char/ako2.png";
  $('#coverChar').src=savedSrc; $('#gameChar').src=savedSrc;
  $('#cover').classList.add('hidden'); $('#game').classList.remove('hidden');
  renderHUD();
  pickSuggest();           // â† è‡ªå‹•ã§æœ€åˆã®ææ¡ˆã‚’å‡ºã™
  pushLog("ã‚¹ã‚¿ãƒ¼ãƒˆ");
});
on($('#backBtn'),'click',()=>{ $('#game').classList.add('hidden'); $('#cover').classList.remove('hidden'); });

on($('#doneBtn'),'click',()=>{ hearts++; localStorage.setItem(LS.HEART, hearts); renderHUD(); pushLog("ã‚„ã£ãŸã‚ˆâ™¡ 1ãƒãƒ¼ãƒˆ"); });

on($('#careMeal'),'click', ()=>{ hearts++; localStorage.setItem(LS.HEART,hearts); renderHUD(); pushLog("ã”ã¯ã‚“ï¼šæº€è¶³ãã†ï¼â™¡+1"); });
on($('#careToilet'),'click', ()=>{ pushLog("ãƒˆã‚¤ãƒ¬ï¼šã‚¹ãƒƒã‚­ãƒªï¼"); });
on($('#carePet'),'click',   ()=>{ hearts++; localStorage.setItem(LS.HEART,hearts); renderHUD(); pushLog("ãªã§ãªã§ï¼šã†ã‚Œã—ã„ï¼â™¡+1"); });

on($('#skipBtn'),'click', ()=>{ pushLog("ã‚¹ã‚­ãƒƒãƒ—ï¼šåˆ¥ã®æ¡ˆã«åˆ‡æ›¿"); pickSuggest(); });
on($('#clearBtn'),'click',()=>{
  if (tCount>=3) return;
  tCount++; localStorage.setItem(LS.TODAY_COUNT, tCount);
  localStorage.setItem(LS.TODAY_DATE, todayStr());
  clearTotal++; localStorage.setItem(LS.CLEAR_TOTAL, clearTotal);
  stamps++; localStorage.setItem(LS.STAMP, stamps);
  $('#clearBtn').disabled=true;
  pushLog(`ææ¡ˆã‚¯ãƒªã‚¢ï¼ã€Œ${currentSuggest}ã€ï½œã‚¹ã‚¿ãƒ³ãƒ—+1`);
  renderHUD();
  // è§£æ”¾æ¡ä»¶
  if (clearTotal===3) openSelectModal();
  if (clearTotal===5 && !localStorage.getItem(LS.CHAR_NAME)) openNameModal();
  autoNextSuggestAfterClear(); // æ¬¡ã®ææ¡ˆã‚’è‡ªå‹•ã§å‡ºã™
});

on($('#saveCharName'),'click', ()=>{
  const v=($('#charNameInput').value||"").trim();
  localStorage.setItem(LS.CHAR_NAME, v);
  pushLog(`ã‚­ãƒ£ãƒ©å‘½åï¼šã€Œ${v||"(æœªè¨­å®š)"}ã€`);
  closeNameModal();
  renderHUD();
});
on($('#closeSelect'),'click', closeSelectModal);
on($('#closeName'),'click', closeNameModal);

/* ========= åˆæœŸãƒ­ãƒ¼ãƒ‰ ========= */
(function boot(){
  // æ—¢å­˜å€¤ã®åæ˜ 
  $('#userNameInput').value = localStorage.getItem(LS.NAME) || "";
  const src = localStorage.getItem(LS.CHAR_SRC) || "public/char/ako2.png";
  $('#coverChar').src=src; $('#gameChar').src=src;
  if (localStorage.getItem(LS.CHAR_NAME)) $('#charNick').textContent = localStorage.getItem(LS.CHAR_NAME);
  renderHUD();

  // ãƒ’ãƒ³ãƒˆ
  if (clearTotal<3) pushLog("ãƒ’ãƒ³ãƒˆï¼šåˆè¨ˆ3å›ã‚¯ãƒªã‚¢ã§ã‚­ãƒ£ãƒ©é¸æŠãŒè§£æ”¾ã•ã‚Œã¾ã™ã€‚");
  else if (clearTotal<5) pushLog("ãƒ’ãƒ³ãƒˆï¼šåˆè¨ˆ5å›ã‚¯ãƒªã‚¢ã§ã‚­ãƒ£ãƒ©å‘½åãŒè§£æ”¾ã•ã‚Œã¾ã™ã€‚");
})();
</script>
</body>
</html>
