<!-- FILE: /MeAI/index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MeAI | Welcome</title>
  <meta name="description" content="MeAI: ãŠä¸–è©±Ã—ä¼šè©±AIÃ—é€²åŒ–ï¼ˆHBDæ¼”å¥ï¼‰ã‚’çµ±åˆã—ãŸç ”ç©¶å‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³" />
  <!-- 404å¯¾ç­–ï¼šç°¡æ˜“favicon -->
  <link rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.85em' font-size='80'%3EğŸŒ™%3C/text%3E%3C/svg%3E" />
  <style>
    :root{
      --card-bg: rgba(0,0,0,.38);
      --card-bd: rgba(255,255,255,.18);
      --text:#fff;
      --accent:#f7b0bf;
      --accent-ink:#222;
      --ok:#7CFFB2;
      --ng:#FF8A8A;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:"Noto Sans JP",system-ui,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Noto Color Emoji","Segoe UI Emoji",sans-serif;
      color:var(--text);
      background:#000 center/cover fixed no-repeat;
      background-image:url("public/space_background.png");
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:24px;
    }
    .hero{
      width:min(92vw, 880px);
      text-align:center;
      padding:32px 20px 28px;
      background:linear-gradient(transparent,rgba(0,0,0,.25));
      border-radius:20px;
    }
    .hero img#hero-ako{
      display:block;margin:0 auto 22px;width:min(42vw,260px);height:auto;
      filter: drop-shadow(0 6px 18px rgba(0,0,0,.35));
    }
    h1{margin:0 0 14px;font-size:clamp(28px,5vw,44px);letter-spacing:.02em;text-shadow:0 2px 10px rgba(0,0,0,.6);}
    .lead{margin:0 auto 20px;width:min(90%, 740px);font-size:clamp(15px,2.2vw,18px);line-height:1.9;text-shadow:0 1px 6px rgba(0,0,0,.55);}
    .cta{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:4px}
    .primary,.ghost{
      padding:.9rem 1.3rem;border:0;border-radius:14px;cursor:pointer;
      font-weight:800;box-shadow:0 6px 18px rgba(0,0,0,.35);transition:transform .06s ease;
    }
    .primary{ background:var(--accent); color:var(--accent-ink); }
    .ghost{ background:rgba(255,255,255,.08); color:#fff; border:1px solid rgba(255,255,255,.22) }
    .primary:active,.ghost:active{ transform:translateY(1px) }
    .lang{ margin-top:14px; font-size:14px; opacity:.95; user-select:none; }
    .lang button{ background:none;border:0;color:#fff;text-decoration:underline;cursor:pointer;padding:2px 4px;margin:0 2px }
    .note{font-size:12px;opacity:.8;margin-top:10px}
    .badge{
      display:inline-flex;gap:6px;align-items:center;
      font-size:12px;border:1px solid var(--card-bd);padding:6px 10px;border-radius:999px;
      background:rgba(255,255,255,.06);backdrop-filter:saturate(120%) blur(2px);
      margin: 8px auto 0;
    }
    .dot{width:8px;height:8px;border-radius:50%;}
    .ok{background:var(--ok);} .ng{background:var(--ng);}
  </style>
</head>
<body>
  <div class="hero" role="banner" aria-label="MeAI hero">
    <!-- â˜… ã‚­ãƒ£ãƒ©ç”»åƒï¼ˆå·®ã—æ›¿ãˆå¯ï¼‰ -->
    <img id="hero-ako" src="public/ako.png?v=2" alt="ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’å¼¾ãã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼" loading="eager" />

    <h1 id="t_title">MeAIã¸ã‚ˆã†ã“ã</h1>
    <p id="t_desc" class="lead">
      â€œãŠä¸–è©±â€ã§å¿ƒã‚’è‚²ã¦ã€â€œä¼šè©±AIâ€ã§æ—¥ã€…ã‚’è¨˜éŒ²ã€‚ãƒã‚¤ãƒ³ãƒˆãŒè²¯ã¾ã‚‹ã¨èª•ç”Ÿæ—¥ã®æ›²ãŒå®Œæˆã—ã¦é€²åŒ–ã—ã¾ã™ã€‚
    </p>

    <!-- API ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
    <div id="api_badge" class="badge" aria-live="polite">
      <span class="dot ng" id="api_dot"></span><span id="api_text">API: Checkingâ€¦</span>
    </div>

    <div class="cta">
      <!-- â˜… ã¯ã˜ã‚ã‚‹ï¼šãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æœªè¨­å®šãªã‚‰ name_first.htmlã€è¨­å®šæ¸ˆã¿ãªã‚‰ meai_home.html -->
      <button id="t_start" class="primary" onclick="startFlow()">ã¯ã˜ã‚ã‚‹</button>
      <!-- ç¶šãã‹ã‚‰ï¼ˆé€²è¡ŒçŠ¶æ³ãŒã‚ã‚Œã°è¡¨ç¤ºï¼‰ -->
      <button id="t_continue" class="ghost" style="display:none" onclick="continueFlow()">ã¤ã¥ãã‹ã‚‰</button>
      <!-- ç ”ç©¶ã«ã¤ã„ã¦ï¼ˆabout.htmlã¸ï¼‰ -->
      <button id="t_about" class="ghost" onclick="location.href='about.html'">ã“ã®ç ”ç©¶ã«ã¤ã„ã¦</button>
    </div>

    <div class="lang" aria-label="language switch">
      <button type="button" onclick="setLang('ja')">æ—¥æœ¬èª</button> |
      <button type="button" onclick="setLang('en')">English</button> |
      <button type="button" onclick="setLang('zh-CN')">ç®€ä½“</button> |
      <button type="button" onclick="setLang('zh-TW')">ç¹é«”</button> |
      <button type="button" onclick="setLang('ko')">í•œêµ­ì–´</button>
      <div class="note" id="t_note">è¨€èªè¨­å®šã¯æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã‚‚ä¿æŒã•ã‚Œã¾ã™ã€‚</div>
    </div>
  </div>

  <script>
    /* ====== LocalStorage Keys ====== */
    const LS = {
      LANG: 'MEAI_LANG',
      PROGRESS: 'MEAI_PROGRESS',      // 'seed' | 'care' | 'talk' | 'evolved'
      USER_NAME: 'MEAI_USER_NAME',    // ã‚ãªãŸã®åå‰
      CHAR_NAME: 'MEAI_CHAR_NAME',    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®åå‰
      API_BASE: 'MEAI_API_BASE'       // ä»»æ„: ä¸Šæ›¸ãç”¨
    };

    /* ====== API Endpoint ======
       æ—¢å­˜ã® TALK_ENDPOINT ã‚’ãã®ã¾ã¾ä½¿ã„ãŸã„è¦ä»¶ã«å¯¾å¿œã€‚
       1) localStorage.MEAI_API_BASE ãŒã‚ã‚Œã°å„ªå…ˆ
       2) ãªã‘ã‚Œã° window.TALK_ENDPOINT ã‚’ä½¿ç”¨
       3) ã©ã¡ã‚‰ã‚‚ç„¡ã‘ã‚Œã°ç›¸å¯¾ 'api/talk' ã‚’ä»®å®š
    */
    const TALK_ENDPOINT = (
      localStorage.getItem(LS.API_BASE)
      || (typeof window.TALK_ENDPOINT === 'string' ? window.TALK_ENDPOINT : '')
    ) || 'api/talk';

    /* ====== i18n ====== */
    const I18N = {
      "ja": {
        title: "MeAIã¸ã‚ˆã†ã“ã",
        desc:  "â€œãŠä¸–è©±â€ã§å¿ƒã‚’è‚²ã¦ã€â€œä¼šè©±AIâ€ã§æ—¥ã€…ã‚’è¨˜éŒ²ã€‚ãƒã‚¤ãƒ³ãƒˆãŒè²¯ã¾ã‚‹ã¨èª•ç”Ÿæ—¥ã®æ›²ãŒå®Œæˆã—ã¦é€²åŒ–ã—ã¾ã™ã€‚",
        start: "ã¯ã˜ã‚ã‚‹",
        cont:  "ã¤ã¥ãã‹ã‚‰",
        about: "ã“ã®ç ”ç©¶ã«ã¤ã„ã¦",
        note:  "è¨€èªè¨­å®šã¯æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã‚‚ä¿æŒã•ã‚Œã¾ã™ã€‚",
        api_ok:"API: Online",
        api_ng:"API: Offline"
      },
      "en": {
        title: "Welcome to MeAI",
        desc:  "Care grows bond, chats log your days. Earn points to complete the birthday song and evolve.",
        start: "Start",
        cont:  "Continue",
        about: "About this research",
        note:  "Your language preference is saved for your next visit.",
        api_ok:"API: Online",
        api_ng:"API: Offline"
      },
      "zh-CN": {
        title: "æ¬¢è¿æ¥åˆ° MeAI",
        desc:  "é€šè¿‡â€œç…§æ–™â€å»ºç«‹æƒ…æ„Ÿã€ç”¨å¯¹è¯è®°å½•ç”Ÿæ´»ã€‚ç§¯åˆ†ç´¯ç§¯åç”Ÿæ—¥æ›²å®Œæˆå¹¶è¿›åŒ–ï¼",
        start: "å¼€å§‹",
        cont:  "ç»§ç»­",
        about: "å…³äºæœ¬ç ”ç©¶",
        note:  "è¯­è¨€è®¾ç½®ä¼šåœ¨ä¸‹æ¬¡è®¿é—®æ—¶ä¿ç•™ã€‚",
        api_ok:"APIï¼šåœ¨çº¿",
        api_ng:"APIï¼šç¦»çº¿"
      },
      "zh-TW": {
        title: "æ­¡è¿ä¾†åˆ° MeAI",
        desc:  "ç”¨ã€Œç…§é¡§ã€åŸ¹é¤Šé€£çµã€ä»¥å°è©±è¨˜éŒ„ç”Ÿæ´»ã€‚ç´¯ç©é»æ•¸å¾Œç”Ÿæ—¥æ›²å®Œæˆä¸¦é€²åŒ–ï¼",
        start: "é–‹å§‹",
        cont:  "å¾ä¸Šæ¬¡ç¹¼çºŒ",
        about: "é—œæ–¼æœ¬ç ”ç©¶",
        note:  "èªè¨€è¨­å®šæœƒåœ¨ä¸‹æ¬¡é€ è¨ªæ™‚ä¿ç•™ã€‚",
        api_ok:"APIï¼šåœ¨ç·š",
        api_ng:"APIï¼šé›¢ç·š"
      },
      "ko": {
        title: "MeAIì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤",
        desc:  "ëŒë´„ìœ¼ë¡œ ìœ ëŒ€ê°€ ìë¼ê³ , ëŒ€í™”ë¡œ í•˜ë£¨ë¥¼ ê¸°ë¡í•´ìš”. í¬ì¸íŠ¸ê°€ ëª¨ì´ë©´ ìƒì¼ ë…¸ë˜ê°€ ì™„ì„±ë˜ê³  ì§„í™”í•©ë‹ˆë‹¤.",
        start: "ì‹œì‘í•˜ê¸°",
        cont:  "ì´ì–´í•˜ê¸°",
        about: "ì—°êµ¬ ì†Œê°œ",
        note:  "ì–¸ì–´ ì„¤ì •ì€ ë‹¤ìŒ ë°©ë¬¸ ì‹œì—ë„ ìœ ì§€ë©ë‹ˆë‹¤.",
        api_ok:"API: ì˜¨ë¼ì¸",
        api_ng:"API: ì˜¤í”„ë¼ì¸"
      }
    };

    function applyLang(lang){
      const t = I18N[lang] || I18N.ja;
      document.documentElement.lang = lang.startsWith('zh') ? 'zh' : lang;
      document.getElementById('t_title').textContent = t.title;
      document.getElementById('t_desc').textContent  = t.desc;
      document.getElementById('t_start').textContent = t.start;
      document.getElementById('t_about').textContent = t.about;
      document.getElementById('t_note').textContent  = t.note;

      const contBtn = document.getElementById('t_continue');
      if (contBtn.style.display !== 'none') contBtn.textContent = t.cont;

      // APIãƒãƒƒã‚¸æ–‡è¨€ã‚‚æ›´æ–°
      const apiText = document.getElementById('api_text');
      const dot = document.getElementById('api_dot');
      if (dot.classList.contains('ok')) apiText.textContent = t.api_ok;
      else apiText.textContent = t.api_ng;
    }
    function setLang(lang){ localStorage.setItem(LS.LANG, lang); applyLang(lang); }

    /* ====== ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ======
      - Start: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒç„¡ã‘ã‚Œã° name_first.htmlã€ã‚ã‚Œã° meai_home.html
      - Continue: é€²è¡ŒçŠ¶æ³ã§åˆ†å²
    */
    function startFlow(){
      const hasName = !!localStorage.getItem(LS.USER_NAME);
      const hasChar = !!localStorage.getItem(LS.CHAR_NAME);
      if (!hasName || !hasChar) {
        location.href = 'name_first.html'; // ã‚ãªãŸã®åå‰â†’ã‚­ãƒ£ãƒ©åã®é †ï¼ˆè¦ä»¶åæ˜ ï¼‰
        return;
      }
      location.href = 'meai_home.html';
    }

    function continueFlow(){
      const step = localStorage.getItem(LS.PROGRESS); // 'seed' | 'care' | 'talk' | 'evolved'
      switch(step){
        case 'seed':     location.href = 'seed_select.html'; break;
        case 'care':     location.href = 'care.html'; break;           // ãŠä¸–è©±ç”»é¢ï¼ˆWhoAIã®ã‚±ã‚¢æµç”¨ï¼‰
        case 'talk':     location.href = 'talk.html'; break;           // ä¼šè©±ç”»é¢ï¼ˆTALK_ENDPOINTé€£æºï¼‰
        case 'evolved':  location.href = 'evolved.html'; break;        // HBDæ¼”å¥å¾Œã®é€²åŒ–ç”»é¢
        default:         location.href = 'meai_home.html'; break;      // ãƒ›ãƒ¼ãƒ ï¼ˆææ¡ˆãƒ»ã”è¤’ç¾ãƒ»ãƒ­ã‚°ç­‰ï¼‰
      }
    }

    /* ====== APIèµ·å‹•ãƒã‚§ãƒƒã‚¯ ======
       - ã¾ãš HEAD ã‚’è©¦è¡Œï¼ˆCORSã§è½ã¡ã‚‹å ´åˆGETï¼‰
       - æˆåŠŸã§ Onlineã€å¤±æ•—ã§ Offline
    */
    async function checkAPI(){
      const apiText = document.getElementById('api_text');
      const dot = document.getElementById('api_dot');
      const lang = localStorage.getItem(LS.LANG) || detectLang();
      const t = I18N[lang] || I18N.ja;

      async function tryFetch(method){
        try{
          const res = await fetch(TALK_ENDPOINT, { method, mode:'cors' });
          return res && (res.ok || (res.status >= 200 && res.status < 500));
        }catch(_e){ return false; }
      }

      let ok = await tryFetch('HEAD');
      if (!ok) ok = await tryFetch('GET');

      if (ok){
        dot.classList.remove('ng'); dot.classList.add('ok');
        apiText.textContent = t.api_ok;
      }else{
        dot.classList.remove('ok'); dot.classList.add('ng');
        apiText.textContent = t.api_ng;
      }
    }

    function detectLang(){
      const browser = (navigator.language || 'ja').toLowerCase();
      return (['ja','en','zh-cn','zh-tw','ko'].find(k => browser.startsWith(k)) || 'ja');
    }

    /* ====== åˆæœŸåŒ– ====== */
    (function init(){
      // è¨€èª
      const savedLang = localStorage.getItem(LS.LANG) || detectLang();
      applyLang(savedLang);

      // é€²è¡ŒçŠ¶æ³ãŒã‚ã‚‹å ´åˆã®ã¿ã€Œã¤ã¥ãã‹ã‚‰ã€ã‚’è¡¨ç¤º
      const hasProgress = !!localStorage.getItem(LS.PROGRESS);
      if (hasProgress) document.getElementById('t_continue').style.display = '';

      // APIãƒã‚§ãƒƒã‚¯
      checkAPI();
    })();
  </script>
</body>
</html>
